<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Workout Log</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="container">
        <h2>üèãÔ∏è‚Äç‚ôÇÔ∏è Monde Vivant - Workout Log</h2>

        <label>Nom de la s√©ance / Muscle</label>
        <input type="text" id="sessionName" placeholder="ex: Pectoraux / Triceps">

        <div class="row">
            <div class="col">
                <label>Date</label>
                <input type="date" id="dateInput">
            </div>
            <div class="col">
                <label>Heure</label>
                <input type="time" id="timeInput">
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">

        <!-- S√©ance Pr√©-programm√©e Section -->
        <div id="pre-programmed-session" class="exercise-section">
            <h3>üéØ S√©ance Pr√©-programm√©e</h3>
            <p>Chargez un objectif de s√©ance depuis un fichier de log (.json).</p>
            <div class="row">
                <div class="col">
                    <label for="session-url-selector">S√©ance en ligne :</label>
                    <select id="session-url-selector" name="session-url-selector">
                        <option value="">Chargement des s√©ances...</option>
                    </select>
                </div>
                <div class="col">
                    <label for="session-goal-file">Charger un objectif (local) :</label>
                    <input type="file" id="session-goal-file" accept=".json" onchange="loadSessionGoal(event)">
                </div>
            </div>
            <div id="session-goal-display">
                <!-- Le contenu de l'objectif sera affich√© ici -->
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">

        <div class="layout-wrapper">
            <div class="main-column">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <label style="margin-bottom: 0;">Exercice</label>
                    <select id="dataSourceSelector" style="padding: 2px; font-size: 0.85em;">
                        <!-- JS populated -->
                    </select>
                </div>
                <div class="autocomplete-container">
                    <input type="text" id="exercise" placeholder="ex: Bench Press" autocomplete="off">
                    <div id="autocomplete-list" class="autocomplete-items" style="display: none;"></div>
                </div>

                <!-- 3. Log Section -->
                <div id="exercise-log" class="exercise-section">
                    <h3>üìù Log</h3>

                    <div class="row">
                        <div class="col">
                            <label>S√©rie</label>
                            <input type="number" id="setNum" placeholder="1" value="1" min="0" inputmode="numeric">
                        </div>
                        <div class="col">
                            <label>Reps</label>
                            <input type="number" id="reps" placeholder="0" min="0" inputmode="numeric">
                        </div>
                        <div class="col">
                            <label>Poids (lb)</label>
                            <input type="number" id="weight" placeholder="0" min="0" inputmode="numeric">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label>Pas</label>
                            <input type="number" id="steps" placeholder="0" min="0" inputmode="numeric">
                        </div>
                        <div class="col">
                            <label>Distance (km)</label>
                            <input type="text" id="distance" placeholder="0.0" oninput="formatDistance(this)"
                                inputmode="decimal">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label>Kcal</label>
                            <input type="number" id="kcal" placeholder="0" min="0" inputmode="numeric">
                        </div>
                        <div class="col">
                            <label>Temps (hh:mm:ss)</label>
                            <input type="text" id="duration" placeholder="00:00:00" oninput="formatDuration(this)"
                                inputmode="numeric">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label>FC Moyenne (bpm)</label>
                            <input type="number" id="avgHr" placeholder="0" min="0" inputmode="numeric">
                        </div>
                        <div class="col">
                            <label>FC Maximum (bpm)</label>
                            <input type="number" id="maxHr" placeholder="0" min="0" inputmode="numeric">
                        </div>
                    </div>

                    <label>Notes</label>
                    <input type="text" id="notes" placeholder="ex: Bonne forme, difficile...">

                    <button class="btn-add" onclick="addSet()">‚ûï Ajouter la s√©rie</button>
                </div>
                <!-- End of Log Section -->

                <!-- Demonstration Section -->
                <div id="exercise-demonstration" class="exercise-section" style="display: none;">
                    <h3 class="collapsible-header">üí™ D√©monstration</h3>
                    <div class="collapsible-content" style="display: none;">
                        <img id="exercise-image" src="" alt="D√©monstration de l'exercice"
                            style="width: 100%; max-width: 400px; display: block; margin: auto;">
                    </div>
                </div>

                <!-- 1. Information Section -->
                <div id="exercise-information" class="exercise-section" style="display: none;">
                    <h3 class="collapsible-header">üìã Information</h3>
                    <div class="collapsible-content" style="display: none;">
                        <div id="info-content"></div>
                    </div>
                </div>
            </div>
            <div class="side-column">
                <!-- 2. Chronom√®tre Section -->
                <div id="exercise-timer" class="exercise-section" style="display: none;">
                    <h3 class="collapsible-header">‚è±Ô∏è Chronom√®tre</h3>
                    <div class="collapsible-content" style="display: none;">
                        <div id="timer-display">
                            <div class="timer-phase" id="prep-timer">Prep: <span>0</span>s</div>
                            <div class="timer-phase" id="effort-timer">Effort: <span>0</span>s</div>
                            <div class="timer-phase" id="rest-timer">Rest: <span>0</span>s</div>
                            <div class="timer-phase" id="end-timer">End: <span>0</span>s</div>
                        </div>
                        <div class="timer-controls">
                            <div class="theme-selector">
                                <label for="sound-theme">üéµ Th√®me:</label>
                                <select id="sound-theme">
                                    <option value="random">üé≤ Al√©atoire</option>
                                </select>
                            </div>
                            <div class="theme-selector">
                                <label for="ambient-music">üéß Ambiance:</label>
                                <select id="ambient-music">
                                    <option value="none">üîá Aucun</option>
                                    <option value="random">üé≤ Al√©atoire</option>
                                    <!-- Options will be populated dynamically from sound_manifest.js -->
                                </select>
                            </div>
                            <button id="start-timer" class="btn-timer">‚ñ∂Ô∏è Start</button>
                            <button id="pause-timer" class="btn-timer">‚è∏Ô∏è Pause</button>
                            <button id="reset-timer" class="btn-timer">üîÑ Reset</button>
                        </div>
                        <div id="current-phase" class="current-phase"></div>
                    </div>
                </div>

                <!-- Compte √† rebours Section -->
                <div id="countdown-section" class="exercise-section">
                    <h3 class="collapsible-header">‚è≥ Compte √† rebours</h3>
                    <div class="collapsible-content" style="display: none;">
                        <div class="countdown-timer-display">
                            <input type="number" id="countdown-time-input" value="60" min="1" inputmode="numeric">
                        </div>
                        <div class="countdown-controls">
                            <div class="theme-selector">
                                <label for="countdown-sound-theme">üéµ Th√®me:</label>
                                <select id="countdown-sound-theme">
                                    <option value="Prep">Prep</option>
                                    <option value="Effort">Effort</option>
                                    <option value="Rest">Rest</option>
                                    <option value="End">End</option>
                                </select>
                            </div>
                            <button id="start-countdown" class="btn-timer">‚ñ∂Ô∏è Start</button>
                            <button id="pause-countdown" class="btn-timer">‚è∏Ô∏è Pause</button>
                            <button id="reset-countdown" class="btn-timer">üîÑ Reset</button>
                        </div>
                    </div>
                </div>

                <!-- Audio Player Section -->
                <div id="audio-player-container" class="exercise-section">
                    <h3 class="collapsible-header">üéµ Lecteur Ambiance</h3>
                    <div class="collapsible-content" style="display: none;">
                        <div id="track-info">
                            <span id="track-title"></span>
                        </div>
                        <audio id="ambient-audio-player" style="display: none;"></audio>

                        <div class="progress-container" id="progress-container">
                            <div class="time-display">
                                <span id="current-time">00:00</span>
                                <span id="total-duration">00:00</span>
                            </div>
                            <div class="progress-bar-wrapper">
                                <div id="progress-bar"></div>
                            </div>
                        </div>

                        <div class="audio-controls">
                            <button id="prev-track" class="btn-audio">‚èÆÔ∏è</button>
                            <button id="play-pause-audio" class="btn-audio">‚ñ∂Ô∏è</button>
                            <button id="next-track" class="btn-audio">‚è≠Ô∏è</button>
                            <button id="shuffle-playlist" class="btn-audio">üîÄ</button>
                            <div class="volume-control">
                                <label for="volume-slider">üîä</label>
                                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
                                <span id="volume-level">100%</span>
                            </div>
                        </div>
                        <div id="playlist-container">
                            <ul id="playlist"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Exo</th>
                    <th>S√©rie</th>
                    <th>Reps</th>
                    <th>Poids</th>
                    <th>Pas</th>
                    <th>Dist</th>
                    <th>Kcal</th>
                    <th>Temps</th>
                    <th>FC Moy</th>
                    <th>FC Max</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody id="logTable"></tbody>
        </table>

        <div class="status" id="statusMsg" style="display: none;"></div>

        <button class="btn-save" onclick="saveLog()">üìÇ Sauvegarder vers Drive</button>
        <button class="btn-clear" onclick="clearWorkout()">üóëÔ∏è Effacer la s√©ance</button>
    </div>

    <!-- Data Injection Point - Scripts loaded at end of body for proper DOM loading -->
    <!-- Dynamic Data Source Loading -->
    <script>
        const AVAILABLE_DATA_SOURCES = [
            { name: "Entra√Ænement", file: "data_exercices.js" },
            { name: "Entra√Ænement Simple", file: "data_exercices_simple.js" }
        ];

        const STORAGE_KEY_SOURCE = 'workoutDataSource';
        let selectedSourceFile = localStorage.getItem(STORAGE_KEY_SOURCE) || "data_exercices.js";

        // Ensure selected file is valid
        if (!AVAILABLE_DATA_SOURCES.some(src => src.file === selectedSourceFile)) {
            selectedSourceFile = "data_exercices.js";
        }

        document.write('<script src="' + selectedSourceFile + '"><\/script>');
    </script>
    <script src="data_exercices_complet.js"></script>
    <script src="sound_manifest.js"></script>
    <script>
        // Map external data to internal variable for compatibility
        const EXERCISE_DATA = exercicesCategories;
        const EXERCISE_DETAILS = db_exercices;

        // Logic for Data Source Selector
        (function () {
            const selector = document.getElementById('dataSourceSelector');
            if (!selector) return;

            const sources = [
                { name: "Entra√Ænement Standard", file: "data_exercices.js" },
                { name: "Entra√Ænement Simple", file: "data_exercices_simple.js" }
            ];
            const STORAGE_KEY = 'workoutDataSource';
            const current = localStorage.getItem(STORAGE_KEY) || "data_exercices.js";

            sources.forEach(src => {
                const opt = document.createElement('option');
                opt.value = src.file;
                opt.textContent = src.name;
                if (src.file === current) opt.selected = true;
                selector.appendChild(opt);
            });

            selector.addEventListener('change', function () {
                localStorage.setItem(STORAGE_KEY, this.value);
                // Reload to apply the new script
                location.reload();
            });
        })();
    </script>
    <script src="app.js"></script>
</body>

</html>